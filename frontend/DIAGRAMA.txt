# Diagrama de Arquitectura NextChat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NAVEGADOR (Browser)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          index.html                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚ Login  â”‚  â”‚ Chat   â”‚  â”‚ Messages â”‚  â”‚ Video    â”‚             â”‚  â”‚
â”‚  â”‚  â”‚ Form   â”‚  â”‚ Header â”‚  â”‚ Area     â”‚  â”‚ Call UI  â”‚             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    app.js (Entry Point)                           â”‚  â”‚
â”‚  â”‚              <script type="module" src="app.js">                  â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚   document.addEventListener('DOMContentLoaded', () => {           â”‚  â”‚
â”‚  â”‚     const app = new ChatApplication();                            â”‚  â”‚
â”‚  â”‚     app.init();                                                    â”‚  â”‚
â”‚  â”‚   });                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ChatApplication (Facade Pattern)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Inicializa todos los managers (Singletons)                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Configura listeners de WebSocket (Observer)               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Configura listeners de UI                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Coordina flujo entre mÃ³dulos                              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“             â†“              â†“              â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ WebSocket â”‚  â”‚    UI     â”‚  â”‚   File    â”‚  â”‚  VideoCall   â”‚        â”‚
â”‚  â”‚  Manager  â”‚  â”‚  Manager  â”‚  â”‚  Manager  â”‚  â”‚   Manager    â”‚        â”‚
â”‚  â”‚(Singleton)â”‚  â”‚(Singleton)â”‚  â”‚(Singleton)â”‚  â”‚  (Singleton) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â†“              â†“              â†“                 â†“                  â”‚
â”‚  Observa eventos  Manipula     Procesa         Gestiona               â”‚
â”‚  de conexiÃ³n      el DOM       archivos        WebRTC                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              MessageHandler (Strategy Pattern)                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ strategies = Map([                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ['auth_ok', handleAuthOk],                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ['text', handleTextMessage],                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ['file', handleFileMessage],                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ['webrtc_offer', handleWebRTCOffer],                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ...                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ])                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DOMUtils (Utilidades)    â”‚  â”‚  FileUtils (Utilidades)        â”‚    â”‚
â”‚  â”‚ â€¢ $() querySelector       â”‚  â”‚ â€¢ arrayBufferToBase64()        â”‚    â”‚
â”‚  â”‚ â€¢ escapeHtml()            â”‚  â”‚ â€¢ base64ToArrayBuffer()        â”‚    â”‚
â”‚  â”‚ â€¢ formatTime()            â”‚  â”‚ â€¢ getEmojiByExtension()        â”‚    â”‚
â”‚  â”‚ â€¢ getAvatarSVG()          â”‚  â”‚ â€¢ base64ToBlob()               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†•
                    WebSocket (ws://server:8081)
                                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SERVIDOR JAVA                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              ChatWebSocketServer.java                             â”‚ â”‚
â”‚  â”‚  â€¢ onOpen()  â†’ Acepta conexiones                                  â”‚ â”‚
â”‚  â”‚  â€¢ onMessage() â†’ Procesa mensajes JSON                            â”‚ â”‚
â”‚  â”‚  â€¢ onClose() â†’ Limpia recursos                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    FLUJO DE DATOS - EJEMPLO: LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario escribe credenciales â†’ Click en "Iniciar SesiÃ³n"
                                        â†“
                         ChatApplication.handleLogin()
                                        â†“
                         UIManager.getInputValues()
                                        â†“
                      WebSocketManager.connect()
                                        â†“
                 WebSocketManager.authenticate(user, pass)
                                        â†“
                    ws.send({type: 'auth', username, password})
                                        â†“
                              SERVIDOR JAVA
                    ChatWebSocketServer.onMessage()
                         UserDAO.authenticate()
                                        â†“
                    ws.send({type: 'auth_ok', username})
                                        â†“
                  WebSocketManager.onmessage (event)
                                        â†“
                    WebSocketManager.emit('message', data)
                                        â†“
                    MessageHandler.handleMessage(data)
                                        â†“
              Strategy: strategies.get('auth_ok')(data)
                                        â†“
                    MessageHandler.handleAuthOk(data)
                                        â†“
                  UIManager.showChatScreen(username)
                                        â†“
                    DOM: Ocultar login, mostrar chat


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              FLUJO DE DATOS - EJEMPLO: VIDEOLLAMADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario click en botÃ³n ğŸ“¹ â†’ ChatApplication.handleToggleVideoCall()
                                        â†“
                   VideoCallManager.joinCall(username)
                                        â†“
              navigator.mediaDevices.getUserMedia({video, audio})
                                        â†“
                VideoCallManager.addLocalVideo(username)
                                        â†“
              WebSocketManager.send({type: 'join_room'})
                                        â†“
                              SERVIDOR JAVA
                  ChatWebSocketServer: case "join_room"
                  videoRoomUsers.put(username, conn)
                                        â†“
         broadcast: {type: 'room_users', users: ['user1', 'user2']}
                                        â†“
              WebSocketManager.emit('message', data)
                                        â†“
              MessageHandler.handleRoomUsers(data.users)
                                        â†“
            VideoCallManager.handleRoomUsers(['user1', 'user2'])
                                        â†“
         Para cada usuario remoto en la sala:
         VideoCallManager.createPeerConnection(username, true)
                                        â†“
              pc = new RTCPeerConnection(rtcConfig)
              pc.addTrack(localStream.videoTrack)
              pc.addTrack(localStream.audioTrack)
                                        â†“
                    pc.createOffer()
                                        â†“
              WebSocketManager.send({type: 'webrtc_offer', to, offer})
                                        â†“
                              SERVIDOR JAVA
               ReenvÃ­a oferta al usuario destinatario
                                        â†“
         Usuario destinatario recibe oferta
         MessageHandler.handleWebRTCOffer(from, offer)
                                        â†“
           VideoCallManager.handleOffer(from, offer)
                                        â†“
                 pc.setRemoteDescription(offer)
                 answer = pc.createAnswer()
                 pc.setLocalDescription(answer)
                                        â†“
            WebSocketManager.send({type: 'webrtc_answer', to, answer})
                                        â†“
                              SERVIDOR JAVA
             ReenvÃ­a respuesta al usuario original
                                        â†“
         MessageHandler.handleWebRTCAnswer(from, answer)
                                        â†“
          VideoCallManager.handleAnswer(from, answer)
                                        â†“
               pc.setRemoteDescription(answer)
                                        â†“
              Intercambio de ICE candidates
         pc.onicecandidate â†’ send webrtc_ice â†’ relay
                                        â†“
                    CONEXIÃ“N P2P ESTABLECIDA
         pc.ontrack â†’ VideoCallManager.addRemoteVideo(username, stream)
                                        â†“
                DOM: Agregar <video> al videoGrid


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                     PATRONES DE DISEÃ‘O APLICADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SINGLETON PATTERN                                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚ Garantiza una Ãºnica instancia de cada manager                         â”‚
â”‚                                                                        â”‚
â”‚ WebSocketManager.getInstance()  â”€â”€â”€â”€â”                                â”‚
â”‚ UIManager.getInstance()         â”€â”€â”€â”€â”¤â†’ Misma instancia en toda la appâ”‚
â”‚ FileManager.getInstance()       â”€â”€â”€â”€â”¤                                â”‚
â”‚ VideoCallManager.getInstance()  â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OBSERVER PATTERN                                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚ WebSocketManager notifica eventos a mÃºltiples listeners              â”‚
â”‚                                                                        â”‚
â”‚ WebSocketManager.on('message', callback1)  â”                         â”‚
â”‚ WebSocketManager.on('message', callback2)  â”œâ”€â†’ Todos notificados     â”‚
â”‚ WebSocketManager.on('message', callback3)  â”˜                         â”‚
â”‚                        â†“                                               â”‚
â”‚         WebSocketManager.emit('message', data)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STRATEGY PATTERN                                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚ MessageHandler usa estrategias especÃ­ficas por tipo de mensaje        â”‚
â”‚                                                                        â”‚
â”‚ message.type = 'auth_ok'   â”€â”€â†’  handleAuthOk()                       â”‚
â”‚ message.type = 'text'      â”€â”€â†’  handleTextMessage()                  â”‚
â”‚ message.type = 'file'      â”€â”€â†’  handleFileMessage()                  â”‚
â”‚ message.type = 'webrtc_*'  â”€â”€â†’  handleWebRTC*()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FACADE PATTERN                                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚ ChatApplication coordina todos los mÃ³dulos complejos                  â”‚
â”‚                                                                        â”‚
â”‚ ChatApplication.init()                                                â”‚
â”‚       â”œâ”€â†’ setupWebSocketListeners()                                  â”‚
â”‚       â””â”€â†’ setupUIListeners()                                         â”‚
â”‚                                                                        â”‚
â”‚ ChatApplication.handleLogin()                                         â”‚
â”‚       â”œâ”€â†’ wsManager.connect()                                        â”‚
â”‚       â”œâ”€â†’ wsManager.authenticate()                                   â”‚
â”‚       â””â”€â†’ uiManager.showChatScreen()                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                       PRINCIPIOS SOLID APLICADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[S] Single Responsibility Principle
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ WebSocketManager    â†’ Solo comunicaciÃ³n WebSocket
    âœ“ UIManager           â†’ Solo manipulaciÃ³n de UI
    âœ“ FileManager         â†’ Solo gestiÃ³n de archivos
    âœ“ VideoCallManager    â†’ Solo videollamadas WebRTC
    âœ“ MessageHandler      â†’ Solo procesamiento de mensajes

[O] Open/Closed Principle
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ Agregar nuevo tipo de mensaje: solo extender MessageHandler.strategies
    âœ“ Agregar nueva extensiÃ³n de archivo: solo modificar FileUtils.emojiMap

[L] Liskov Substitution Principle
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ No aplica directamente (no hay herencia)
    âœ“ Interfaces consistentes en todos los managers

[I] Interface Segregation Principle
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ Cada manager expone solo mÃ©todos relevantes a su dominio
    âœ“ Sin dependencias innecesarias entre mÃ³dulos

[D] Dependency Inversion Principle
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ ChatApplication depende de abstracciones (managers)
    âœ“ MessageHandler no depende de implementaciones concretas


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ESTRUCTURA DE ARCHIVOS DETALLADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

frontend/
â”‚
â”œâ”€â”€ index.html                   # HTML con <script type="module">
â”œâ”€â”€ styles.css                   # Estilos CSS de la aplicaciÃ³n
â”œâ”€â”€ app.js                       # â­ PUNTO DE ENTRADA - 10 lÃ­neas
â”‚                                  import ChatApplication
â”‚                                  app.init() en DOMContentLoaded
â”‚
â””â”€â”€ js/
    â”‚
    â”œâ”€â”€ ChatApplication.js       # ğŸ¯ FACADE - 200 lÃ­neas
    â”‚                              Coordina todos los managers
    â”‚                              Configura listeners
    â”‚
    â”œâ”€â”€ handlers/
    â”‚   â””â”€â”€ MessageHandler.js    # âš¡ STRATEGY - 150 lÃ­neas
    â”‚                              Map de estrategias por tipo
    â”‚                              Delega a managers apropiados
    â”‚
    â”œâ”€â”€ managers/
    â”‚   â”œâ”€â”€ WebSocketManager.js  # ğŸ”Œ SINGLETON + OBSERVER - 180 lÃ­neas
    â”‚   â”‚                          GestiÃ³n de conexiÃ³n WebSocket
    â”‚   â”‚                          Sistema de eventos (on/emit)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ UIManager.js         # ğŸ¨ SINGLETON - 200 lÃ­neas
    â”‚   â”‚                          ManipulaciÃ³n del DOM
    â”‚   â”‚                          Renderizado de mensajes
    â”‚   â”‚
    â”‚   â”œâ”€â”€ FileManager.js       # ğŸ“ SINGLETON - 120 lÃ­neas
    â”‚   â”‚                          EnvÃ­o/recepciÃ³n de archivos
    â”‚   â”‚                          ConversiÃ³n Base64
    â”‚   â”‚
    â”‚   â””â”€â”€ VideoCallManager.js  # ğŸ“¹ SINGLETON - 350 lÃ­neas
    â”‚                              GestiÃ³n de WebRTC
    â”‚                              Peer connections (mesh topology)
    â”‚
    â””â”€â”€ utils/
        â”œâ”€â”€ DOMUtils.js          # ğŸ› ï¸ UTILIDADES - 80 lÃ­neas
        â”‚                          SelecciÃ³n DOM, escapado HTML
        â”‚                          Formateo de tiempo
        â”‚
        â””â”€â”€ FileUtils.js         # ğŸ› ï¸ UTILIDADES - 100 lÃ­neas
                                   ConversiÃ³n Base64
                                   Emojis por extensiÃ³n


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         BENEFICIOS DE LA REFACTORIZACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES                              DESPUÃ‰S
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ 1 archivo monolÃ­tico             âœ… 9 archivos modulares
âŒ ~1000 lÃ­neas en app.js           âœ… ~150-350 lÃ­neas por archivo
âŒ Variables globales               âœ… Estado en Singletons
âŒ Sin organizaciÃ³n clara           âœ… Responsabilidades bien definidas
âŒ DifÃ­cil de testear               âœ… Cada mÃ³dulo testeable aisladamente
âŒ Alto acoplamiento                âœ… Bajo acoplamiento, alta cohesiÃ³n
âŒ DifÃ­cil agregar features         âœ… Extensible con nuevos managers
âŒ Sin reutilizaciÃ³n                âœ… Utils reutilizables
âŒ Sin patrones de diseÃ±o           âœ… Singleton, Observer, Strategy, Facade
âŒ DifÃ­cil debugging                âœ… Logs claros por mÃ³dulo


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            CÃ“MO USAR LA APLICACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. INICIAR SERVIDOR (Backend Java)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd C:\Users\jose\Desktop\PC3
   mvn clean compile exec:java -Dexec.mainClass="server.MainServer"

2. ABRIR FRONTEND (Live Server)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd C:\Users\jose\Desktop\PC3\frontend\frontend
   # Click derecho en index.html â†’ Open with Live Server
   # O usar cualquier servidor HTTP local

3. FLUJO DE USO
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ Ingresar usuario/contraseÃ±a â†’ Click "Iniciar SesiÃ³n"
   â€¢ Enviar mensajes de texto en el input inferior
   â€¢ Adjuntar archivos con el botÃ³n +
   â€¢ Click en ğŸ“¹ para unirse a videollamada
   â€¢ Controles: ğŸ¤ mute, ğŸ“¹ cÃ¡mara, ğŸ–¥ï¸ compartir pantalla

4. DEBUGGING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ F12 â†’ Console para ver logs de cada mÃ³dulo
   â€¢ console.log en WebSocketManager para ver mensajes
   â€¢ console.log en VideoCallManager para ver estado de peers
